# Project_template

Это шаблон для решения проектной работы. Структура этого файла повторяет структуру заданий. Заполняйте его по мере работы над решением.

# Задание 1. Анализ и планирование

<aside>

Чтобы составить документ с описанием текущей архитектуры приложения, можно часть информации взять из описания компании и условия задания. Это нормально.

</aside>

### 1. Описание функциональности монолитного приложения

**Управление отоплением:**

- Пользователи могут включать/выключать отопление через веб интерфейс
- Система поддерживает отправку команд включение/выключение отопления
- Система может автоматически отправлять команды включение/выключение отопления по показателям датчиков

**Мониторинг температуры:**

- Пользователи могут узнать текущую температуру
- Система поддерживает отправку команды опроса датчиков
- Система не сохраняет историю температур и фактов включения/выключения отопления

**Управление датчиками:**

- Пользователи со специальными правами могут регистрировать/удалять датчики
- Система поддерживает только один тип датчиков  

**Авторизация:**
- Пользователи могут авторизоваться через веб интерфейс, чтобы получить доступ к системе
- Пользователи не могут регистрироваться самостоятельно
- Система поддерживает несколько типов пользователей: клиенты, техники, администраторы


### 2. Анализ архитектуры монолитного приложения

**Язык программирования**: Go

**База данных**: PostgreSQL

**Архитектура приложения**: Монолитная, вся логика находится внутри одного приложения, в том числе обработка запросов и работа с базой данных.

**Взаимодействие с внешними системами**: взаимодействует с датчиками, запросы обрабатываются синхронно, в одном потоке (последовательно).

**Масштабируемость**: не масштабируется по частям, только увеличением количества приложений.

**Развертывание**: остановкой всего приложения, нет возможности обойтись без даун тайма.

### 3. Определение доменов и границы контекстов

**Контекст авторизации и разграничения прав доступа.**
Включает модели пользователей, ролей, аутентификации и проверки прав доступа к устройствам и функциям системы.

**Контекст телеметрии: сбора и обработки показателей датчиков.**
Включает модели измерений, типов метрик, хранение и предоставление актуальных показателей с устройств.

**Контекст управления отоплением.**
Включает правила включения и выключения отопления, обработку команд управления, работу с состоянием устройств.

**Контекст управления датчиками.**
Включает регистрацию и удаление датчиков пользователями с особыми правами, ограничение системы только одним поддерживаемым типом датчиков.


### **4. Проблемы монолитного решения**

- ограниченная масштабируемость, нельзя масштабировать только опрос датчиков
- сложность внесения изменений (требуется пересборка приложения с даунтаймом)
- жесткая связанность компонентов (предполагаю)
- компоненты не универсальны, не могут быть переиспользованы для др типов датчиков
- сложность тестирования (нужно перетестировать все приложение)
- нет возможности добавления новых датчиков


### 5. Визуализация контекста системы — диаграмма С4

[C1 — Context Diagram](https://disk.yandex.ru/i/t187cJLWf2sxCQ)  
[C2 — Container Diagram](https://disk.yandex.ru/i/bDKgAdonZuSunw)

# Задание 2. Проектирование микросервисной архитектуры

**Диаграмма контейнеров (Containers)**

[C2 — Container Diagram](https://disk.yandex.ru/i/b8_xr6IM9hzyqQ)

**Диаграмма компонентов (Components)**

[C3 - ScenarioService](https://disk.yandex.ru/i/99Vqz8ScTfUkag)

[C3 - LightingService](https://disk.yandex.ru/i/RdCSY7AVioj2Nw)

[C3 - TelemetryService](https://disk.yandex.ru/i/m7aIji0_j-bqHw)

[C3 - CameraService](https://disk.yandex.ru/i/BslYo5fQVu-A-g)

[C3 - GateService](https://disk.yandex.ru/i/_V1mgtdmgGwX1A)

[C3 - HeatingService](https://disk.yandex.ru/i/8iUJUMRDqSkBKA)

[C3 - AdapterService](https://disk.yandex.ru/i/eWv-rtWY5Q_Xpg)

[C3 - DeviceService](https://disk.yandex.ru/i/2c78GmwQ7z3EaA)

**Диаграмма кода (Code)**

[C4 - AdapterService - RoutingComponent](https://disk.yandex.ru/i/MH8nF3Asu1dbjA)

# Задание 3. Разработка ER-диаграммы

[ER диаграмма](https://disk.yandex.ru/i/B2H2GobnBzVCBA)


# Задание 4. Работа с docker и docker-compose

Перейдите в apps.

Там находится приложение-монолит для работы с датчиками температуры. В README.md описано как запустить решение.

Вам нужно:

1) сделать простое приложение temperature-api на любом удобном для вас языке программирования, которое при запросе /temperature?location= будет отдавать рандомное значение температуры.

Locations - название комнаты, sensorId - идентификатор названия комнаты

```
	// If no location is provided, use a default based on sensor ID
	if location == "" {
		switch sensorID {
		case "1":
			location = "Living Room"
		case "2":
			location = "Bedroom"
		case "3":
			location = "Kitchen"
		default:
			location = "Unknown"
		}
	}

	// If no sensor ID is provided, generate one based on location
	if sensorID == "" {
		switch location {
		case "Living Room":
			sensorID = "1"
		case "Bedroom":
			sensorID = "2"
		case "Kitchen":
			sensorID = "3"
		default:
			sensorID = "0"
		}
	}
```

2) Приложение следует упаковать в Docker и добавить в docker-compose. Порт по умолчанию должен быть 8081

3) Кроме того для smart_home приложения требуется база данных - добавьте в docker-compose файл настройки для запуска postgres с указанием скрипта инициализации ./smart_home/init.sql

Для проверки можно использовать Postman коллекцию smarthome-api.postman_collection.json и вызвать:

- Create Sensor
- Get All Sensors

Должно при каждом вызове отображаться разное значение температуры

Ревьюер будет проверять точно так же.

--------
Пятое задание — дополнительное. Его можно сделать по желанию. Чтобы ревьюер быстрее проверил ваше решение, укажите, сделали вы это задание или нет. Для этого оставьте нужный эмодзи около заголовка задания:

✅ — вы выполнили задание.

❌ — вы пропустили задание.

# ✅ ❌ Задание 5. Создание и документирование API

### 1. Тип API

Для всех запросов, кроме проверки авторизации, решила использовать обмен сообщений асинхронным.
Это позволяет сделать сервисы независимыми, если один упал, другие работают.
Но для авторизации важно, чтобы логика была сосредоточена в одном месте. 
Сервис авторизации ключевой. Если он упал, другие сервисы не могут работать корректно.

### 2. Документация API

[asyncApi](https://disk.yandex.ru/d/Nk5md2kDoZ_XYg)
[rest api](https://disk.yandex.ru/d/WDwyxN9-7MF5pA)

